import React, { useEffect, useState, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Flex,
  createFramerTransition,
  transitions,
  Spacer,
  TextButton,
  Outset,
  clsx,
  CallToAction,
} from '@magiclabs/ui';
import Link from 'next/link';
import { useRouter } from 'next/router';
import { Sidenav, useSidenavContext } from 'features/docs/components/sidenav';
import { defaultPageLayout } from 'components/layout/default-page-layout';
import type { MainNavLink, Maybe } from 'graphql/generated';
import { AnalyticsService } from 'lib/analytics-service';
import { getPathFromURL } from 'lib/url-helpers';

import { DocsSubNavbar } from 'features/docs/components/docs-sub-nav';
import styles from './mobile-nav.module.less';
import { MainNavLinkButton } from '../main-nav';

const mobileNavTransition = createFramerTransition().withVariants({
  initial: { x: '100%' },
  animate: { x: 0, transition: { duration: 0.1 } },
});

interface MobileNavProps {
  signUpButton: React.ReactNode;
  navLogoLink: React.ReactNode;
  isDarkNav: boolean;
}

export const MobileNav: React.FC<MobileNavProps> = props => {
  const { signUpButton = null, navLogoLink, isDarkNav } = props;

  const { hasSidenav } = useSidenavContext();

  const router = useRouter();
  const [isOpen, setIsOpen] = useState(false);
  const nodeRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    setIsOpen(false);
  }, [router.pathname]);

  useEffect(() => {
    if (isOpen) document.body.style.overflow = 'hidden';
    return () => {
      document.body.style.overflow = 'auto';
    };
  }, [isOpen]);
  const getBgTransitionProps = transitions.useFade();

  const getFgTransitionProps = mobileNavTransition.use({
    initial: 'initial',
    animate: 'animate',
    exit: 'initial',
  });

  const { mainNav } = defaultPageLayout.useData();
  const { leftLinks, rightLinks } = mainNav!;

  return (
    <>
      {/* Open button */}
      <button className={clsx([styles.openButton, isDarkNav && styles.darkButton])} onClick={() => setIsOpen(true)}>
        <div>
          <img src="/images/mobile-menu.svg" alt="open navigation menu" />
        </div>
      </button>
      <AnimatePresence>
        {/* Background */}
        {isOpen && (
          <motion.div
            key="bg"
            onClick={() => setIsOpen(false)}
            className={styles.background}
            {...getBgTransitionProps()}
          />
        )}

        {/* Mobile nav menu */}
        {isOpen && (
          <motion.div
            key="fg"
            className={clsx([styles.MobileNavMenu, isDarkNav && styles.darkNavMenu])}
            style={hasSidenav ? { paddingBottom: '81px', height: 'calc(100vh - 111px)' } : undefined}
            {...getFgTransitionProps()}
          >
            {/* Close button */}
            <Flex style={{ width: '100%' }}>
              {!isDarkNav ? (
                <>
                  <Link href="/" passHref className={styles.logoLink} aria-label="Magic">
                    <svg width="199" height="40" viewBox="0 0 199 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M16.5931 -0.000489006C18.3235 2.11874 20.2319 4.08688 22.2955 5.8811C20.9193 10.3438 20.1785 15.0852 20.1785 19.9996C20.1785 24.9138 20.9193 29.6549 22.2953 34.1174C20.2317 35.9115 18.3234 37.8796 16.5931 39.9988C14.8611 37.8775 12.9507 35.9076 10.8848 34.112C12.2598 29.6511 13 24.9118 13 19.9997C13 15.0872 12.2597 10.3476 10.8846 5.88646C12.9506 4.09081 14.8611 2.12086 16.5931 -0.000489006ZM6.94119 31.0296C4.75509 29.4974 2.43498 28.1434 0.00193669 26.9887C0.676291 24.7777 1.03905 22.4309 1.03905 19.9993C1.03905 17.5676 0.676261 15.2206 0.00185719 13.0096C2.43485 11.8549 4.75493 10.5009 6.941 8.96881C7.77659 12.51 8.21873 16.2032 8.21873 19.9996C8.21873 23.7958 7.77666 27.4886 6.94119 31.0296ZM24.9675 19.9996C24.9675 23.7958 25.4096 27.4887 26.2451 31.0296C28.4303 29.498 30.7494 28.1445 33.1814 26.9901C32.5068 24.7787 32.1439 22.4314 32.1439 19.9993C32.1439 17.5671 32.5068 15.2197 33.1815 13.0082C30.7496 11.8538 28.4305 10.5003 26.2453 8.96881C25.4097 12.51 24.9675 16.2032 24.9675 19.9996Z"
                        fill="#18171A"
                      />
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M112.278 12.3071C113.84 12.3071 115.106 11.0409 115.106 9.47899C115.106 7.91707 113.84 6.65088 112.278 6.65088C110.716 6.65088 109.45 7.91707 109.45 9.47899C109.45 11.0409 110.716 12.3071 112.278 12.3071ZM44.403 9.12537H50.2355L56.3957 23.8324H56.6578L62.8181 9.12537H68.6506V31.0149H64.0632V16.7675H63.8775L58.0887 30.908H54.9649L49.176 16.714H48.9903V31.0149H44.403V9.12537ZM77.5141 31.3249C75.9121 31.3249 74.5832 30.9151 73.5274 30.0957C72.4716 29.2763 71.9437 28.0542 71.9437 26.4296C71.9437 25.204 72.2386 24.2421 72.8284 23.5438C73.4182 22.8455 74.19 22.336 75.1439 22.0154C76.1051 21.6876 77.1391 21.4739 78.2459 21.3741C79.7022 21.2316 80.7435 21.0819 81.3697 20.9252C81.9959 20.7684 82.309 20.4264 82.309 19.8991V19.835C82.309 19.1581 82.0906 18.6343 81.6537 18.2638C81.224 17.8933 80.6124 17.708 79.8187 17.708C78.9813 17.708 78.3151 17.8862 77.8199 18.2424C77.3248 18.5987 76.9971 19.0512 76.8369 19.5998L72.5335 19.2578C72.8539 17.7615 73.6476 16.5751 74.9146 15.6986C76.1888 14.8222 77.8308 14.384 79.8405 14.384C81.0857 14.384 82.2508 14.5764 83.3357 14.9611C84.4207 15.3459 85.2944 15.948 85.9571 16.7675C86.627 17.5798 86.9619 18.6379 86.9619 19.9419V31.0149H82.5493V28.7383H82.4182C82.0105 29.5007 81.3988 30.1242 80.5833 30.6087C79.775 31.0861 78.752 31.3249 77.5141 31.3249ZM78.8466 28.1825C79.866 28.1825 80.7034 27.8939 81.3588 27.3168C82.0141 26.7325 82.3418 26.0092 82.3418 25.147V23.4049C82.1597 23.526 81.8757 23.6329 81.4898 23.7255C81.1112 23.8181 80.7034 23.9001 80.2665 23.9713C79.8369 24.0355 79.451 24.0925 79.1087 24.1423C78.2932 24.2564 77.6342 24.4808 77.1318 24.8157C76.6367 25.1506 76.3891 25.6387 76.3891 26.28C76.3891 26.907 76.6185 27.3809 77.0772 27.7015C77.5432 28.0222 78.133 28.1825 78.8466 28.1825ZM92.8109 36.1025C94.0997 36.9718 95.8728 37.4065 98.13 37.4065C99.732 37.4065 101.148 37.1713 102.379 36.701C103.609 36.2307 104.574 35.5325 105.273 34.6061C105.98 33.6798 106.333 32.5362 106.333 31.1752V14.5977H101.713V17.3553H101.538C101.334 16.9064 101.035 16.4539 100.642 15.9979C100.249 15.5419 99.7356 15.1607 99.1021 14.8543C98.4686 14.5407 97.6822 14.384 96.7429 14.384C95.5196 14.384 94.3909 14.6975 93.357 15.3245C92.3303 15.9445 91.5038 16.8743 90.8776 18.1142C90.2587 19.354 89.9492 20.9074 89.9492 22.7743C89.9492 24.5913 90.2514 26.0912 90.8557 27.274C91.4674 28.4568 92.2866 29.3368 93.3133 29.914C94.3473 30.4912 95.4941 30.7797 96.7538 30.7797C98.0936 30.7797 99.1495 30.5054 99.9213 29.9568C100.693 29.401 101.232 28.7846 101.538 28.1077H101.734V31.1111C101.734 32.187 101.403 32.9601 100.74 33.4304C100.085 33.9007 99.2514 34.1359 98.2393 34.1359C97.2126 34.1359 96.4225 33.9506 95.8691 33.5801C95.323 33.2167 94.9553 32.8141 94.766 32.3723L90.4625 32.9388C90.7392 34.1786 91.522 35.2332 92.8109 36.1025ZM100.828 26.1411C100.216 26.9534 99.3497 27.3595 98.2283 27.3595C97.0851 27.3595 96.2113 26.9462 95.607 26.1197C95.0026 25.2931 94.7004 24.1709 94.7004 22.7529C94.7004 21.3563 94.999 20.2162 95.5961 19.3326C96.2004 18.4491 97.0778 18.0073 98.2283 18.0073C99.357 18.0073 100.227 18.4384 100.839 19.3006C101.45 20.1628 101.756 21.3135 101.756 22.7529C101.756 24.1994 101.447 25.3287 100.828 26.1411ZM110.035 31.0149V14.5977H114.688V31.0149H110.035ZM121.561 30.2667C122.799 30.9793 124.277 31.3355 125.996 31.3355C127.488 31.3355 128.781 31.0719 129.873 30.5446C130.965 30.0102 131.821 29.2656 132.44 28.3108C133.066 27.3559 133.416 26.2515 133.488 24.9974H129.098C128.959 25.8738 128.617 26.5508 128.071 27.0282C127.525 27.4985 126.851 27.7336 126.05 27.7336C124.965 27.7336 124.095 27.3061 123.44 26.451C122.792 25.5888 122.468 24.3739 122.468 22.8063C122.468 21.253 122.795 20.0523 123.451 19.2044C124.106 18.3564 124.973 17.9325 126.05 17.9325C126.902 17.9325 127.59 18.1854 128.115 18.6913C128.646 19.1901 128.974 19.8492 129.098 20.6687H133.488C133.423 19.4003 133.07 18.2959 132.429 17.3553C131.795 16.4147 130.925 15.6844 129.819 15.1642C128.719 14.6441 127.437 14.384 125.974 14.384C124.277 14.384 122.814 14.7438 121.583 15.4635C120.352 16.176 119.402 17.17 118.732 18.4455C118.07 19.7139 117.738 21.1888 117.738 22.8704C117.738 24.5307 118.066 25.9985 118.721 27.274C119.384 28.5495 120.331 29.547 121.561 30.2667Z"
                        fill="#18171A"
                      />
                      <path
                        d="M188.067 26.668C188.086 27.2182 188.214 27.6899 188.45 28.0829C188.686 28.4563 188.99 28.7609 189.364 28.9968C189.757 29.2129 190.189 29.3702 190.661 29.4684C191.152 29.5667 191.653 29.6158 192.164 29.6158C192.557 29.6158 192.97 29.5863 193.402 29.5274C193.835 29.4684 194.228 29.3603 194.582 29.2031C194.955 29.0459 195.26 28.8199 195.495 28.5251C195.731 28.2107 195.849 27.8176 195.849 27.346C195.849 26.6975 195.603 26.2062 195.112 25.8721C194.621 25.538 194.002 25.2727 193.255 25.0761C192.528 24.86 191.732 24.6733 190.867 24.5161C190.003 24.3392 189.197 24.1034 188.45 23.8086C187.723 23.4941 187.114 23.0618 186.622 22.5115C186.131 21.9613 185.885 21.1948 185.885 20.2122C185.885 19.4458 186.052 18.7874 186.387 18.2372C186.74 17.6869 187.182 17.2447 187.713 16.9106C188.263 16.5569 188.873 16.3014 189.541 16.1442C190.229 15.9673 190.907 15.8789 191.575 15.8789C192.439 15.8789 193.235 15.9575 193.962 16.1147C194.69 16.2523 195.328 16.5078 195.879 16.8812C196.448 17.2349 196.9 17.7262 197.235 18.3551C197.569 18.9643 197.765 19.7307 197.824 20.6544H195.318C195.279 20.1631 195.151 19.7602 194.935 19.4458C194.719 19.1117 194.444 18.8464 194.11 18.6499C193.776 18.4533 193.402 18.3158 192.99 18.2372C192.597 18.1389 192.194 18.0898 191.781 18.0898C191.408 18.0898 191.024 18.1193 190.631 18.1782C190.258 18.2372 189.914 18.3453 189.6 18.5025C189.285 18.64 189.03 18.8366 188.833 19.092C188.637 19.3279 188.538 19.6423 188.538 20.0354C188.538 20.4677 188.686 20.8313 188.981 21.1261C189.295 21.4012 189.688 21.637 190.16 21.8335C190.631 22.0104 191.162 22.1676 191.752 22.3052C192.341 22.4231 192.931 22.5508 193.52 22.6884C194.149 22.826 194.758 22.993 195.348 23.1895C195.957 23.3861 196.488 23.6514 196.94 23.9854C197.411 24.2999 197.785 24.7028 198.06 25.1941C198.355 25.6854 198.502 26.2946 198.502 27.0217C198.502 27.9454 198.306 28.7118 197.913 29.321C197.539 29.9302 197.038 30.4216 196.409 30.7949C195.8 31.1683 195.102 31.4238 194.316 31.5614C193.55 31.7186 192.783 31.7972 192.017 31.7972C191.172 31.7972 190.366 31.7088 189.6 31.5319C188.833 31.355 188.155 31.0701 187.566 30.677C186.976 30.2643 186.504 29.7337 186.151 29.0852C185.797 28.417 185.6 27.6113 185.561 26.668H188.067Z"
                        fill="#18171A"
                      />
                      <path
                        d="M169.149 10.4253H171.655V18.296H171.714C172.126 17.451 172.775 16.8417 173.659 16.4684C174.544 16.0753 175.516 15.8788 176.578 15.8788C177.757 15.8788 178.779 16.095 179.643 16.5273C180.528 16.9597 181.255 17.5492 181.825 18.296C182.414 19.0231 182.856 19.8682 183.151 20.8311C183.446 21.7941 183.593 22.816 183.593 23.8969C183.593 24.9778 183.446 25.9997 183.151 26.9626C182.876 27.9256 182.444 28.7706 181.854 29.4978C181.284 30.2053 180.557 30.7653 179.673 31.178C178.808 31.5907 177.796 31.7971 176.637 31.7971C176.263 31.7971 175.841 31.7578 175.369 31.6792C174.917 31.6006 174.465 31.4728 174.013 31.296C173.561 31.1191 173.129 30.8833 172.716 30.5885C172.323 30.274 171.989 29.8908 171.714 29.4388H171.655V31.4728H169.149V10.4253ZM180.94 23.72C180.94 23.0125 180.842 22.3247 180.646 21.6565C180.469 20.9687 180.184 20.3595 179.791 19.8289C179.417 19.2983 178.926 18.8757 178.317 18.5613C177.727 18.2469 177.03 18.0897 176.224 18.0897C175.379 18.0897 174.661 18.2567 174.072 18.5908C173.482 18.9249 173.001 19.3671 172.627 19.9173C172.254 20.4479 171.979 21.0571 171.802 21.745C171.645 22.4328 171.566 23.1305 171.566 23.8379C171.566 24.5847 171.655 25.3119 171.832 26.0193C172.008 26.7072 172.284 27.3164 172.657 27.847C173.05 28.3776 173.551 28.8099 174.16 29.144C174.77 29.4585 175.507 29.6157 176.371 29.6157C177.236 29.6157 177.953 29.4486 178.523 29.1146C179.113 28.7805 179.584 28.3383 179.938 27.788C180.292 27.2378 180.547 26.6089 180.705 25.9014C180.862 25.1939 180.94 24.4668 180.94 23.72Z"
                        fill="#18171A"
                      />
                      <path
                        d="M166.729 31.414C166.297 31.6695 165.698 31.7972 164.931 31.7972C164.283 31.7972 163.762 31.6203 163.369 31.2666C162.995 30.8932 162.809 30.2938 162.809 29.4684C162.121 30.2938 161.315 30.8932 160.392 31.2666C159.488 31.6203 158.505 31.7972 157.444 31.7972C156.756 31.7972 156.098 31.7186 155.469 31.5614C154.859 31.4042 154.329 31.1585 153.877 30.8244C153.425 30.4903 153.061 30.058 152.786 29.5274C152.531 28.9771 152.403 28.3188 152.403 27.5523C152.403 26.6876 152.55 25.9802 152.845 25.4299C153.14 24.8796 153.523 24.4375 153.995 24.1034C154.486 23.7496 155.036 23.4843 155.646 23.3074C156.274 23.1306 156.913 22.9832 157.562 22.8653C158.249 22.7277 158.898 22.6294 159.507 22.5705C160.136 22.4919 160.686 22.3936 161.158 22.2757C161.63 22.1381 162.003 21.9514 162.278 21.7156C162.553 21.4601 162.691 21.0966 162.691 20.6249C162.691 20.0747 162.583 19.6325 162.367 19.2984C162.17 18.9643 161.905 18.7088 161.571 18.532C161.256 18.3551 160.893 18.2372 160.48 18.1782C160.087 18.1193 159.694 18.0898 159.301 18.0898C158.24 18.0898 157.355 18.2961 156.648 18.7088C155.94 19.1019 155.557 19.8585 155.498 20.9787H152.993C153.032 20.0354 153.228 19.2394 153.582 18.5909C153.936 17.9424 154.407 17.4216 154.997 17.0286C155.587 16.6159 156.255 16.3211 157.002 16.1442C157.768 15.9673 158.584 15.8789 159.448 15.8789C160.136 15.8789 160.814 15.928 161.482 16.0263C162.17 16.1246 162.789 16.3309 163.339 16.6453C163.89 16.9401 164.332 17.3627 164.666 17.9129C165 18.4632 165.167 19.1805 165.167 20.0648V27.9061C165.167 28.4956 165.197 28.928 165.255 29.2031C165.334 29.4782 165.57 29.6158 165.963 29.6158C166.179 29.6158 166.435 29.5667 166.729 29.4684V31.414ZM162.661 23.6022C162.347 23.8381 161.934 24.0149 161.423 24.1328C160.912 24.2311 160.372 24.3195 159.802 24.3981C159.252 24.4571 158.692 24.5357 158.122 24.634C157.552 24.7126 157.041 24.8501 156.589 25.0467C156.137 25.2432 155.763 25.5281 155.469 25.9015C155.194 26.2553 155.056 26.7466 155.056 27.3755C155.056 27.7882 155.135 28.1419 155.292 28.4367C155.469 28.7118 155.685 28.9378 155.94 29.1147C156.215 29.2915 156.53 29.4193 156.884 29.4979C157.237 29.5765 157.611 29.6158 158.004 29.6158C158.829 29.6158 159.537 29.5077 160.126 29.2916C160.716 29.0557 161.197 28.7708 161.571 28.4367C161.944 28.0829 162.219 27.7095 162.396 27.3165C162.573 26.9038 162.661 26.5206 162.661 26.1668V23.6022Z"
                        fill="#18171A"
                      />
                      <path d="M137.26 10.4253H140.061V29.1146H151.204V31.4728H137.26V10.4253Z" fill="#18171A" />
                    </svg>
                  </Link>
                </>
              ) : (
                <>
                  <Link href="/" passHref className={styles.logoLink} aria-label="Magic">
                    <svg width="199" height="40" viewBox="0 0 199 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M16.5931 -0.000489006C18.3235 2.11874 20.2319 4.08688 22.2955 5.8811C20.9193 10.3438 20.1785 15.0852 20.1785 19.9996C20.1785 24.9138 20.9193 29.6549 22.2953 34.1174C20.2317 35.9115 18.3234 37.8796 16.5931 39.9988C14.8611 37.8775 12.9507 35.9076 10.8848 34.112C12.2598 29.6511 13 24.9118 13 19.9997C13 15.0872 12.2597 10.3476 10.8846 5.88646C12.9506 4.09081 14.8611 2.12086 16.5931 -0.000489006ZM6.94119 31.0296C4.75509 29.4974 2.43498 28.1434 0.00193669 26.9887C0.676291 24.7777 1.03905 22.4309 1.03905 19.9993C1.03905 17.5676 0.676261 15.2206 0.00185719 13.0096C2.43485 11.8549 4.75493 10.5009 6.941 8.96881C7.77659 12.51 8.21873 16.2032 8.21873 19.9996C8.21873 23.7958 7.77666 27.4886 6.94119 31.0296ZM24.9675 19.9996C24.9675 23.7958 25.4096 27.4887 26.2451 31.0296C28.4303 29.498 30.7494 28.1445 33.1814 26.9901C32.5068 24.7787 32.1439 22.4314 32.1439 19.9993C32.1439 17.5671 32.5068 15.2197 33.1815 13.0082C30.7496 11.8538 28.4305 10.5003 26.2453 8.96881C25.4097 12.51 24.9675 16.2032 24.9675 19.9996Z"
                        fill="#F8F8FA"
                      />
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M112.278 12.3069C113.84 12.3069 115.106 11.0407 115.106 9.47875C115.106 7.91682 113.84 6.65063 112.278 6.65063C110.716 6.65063 109.45 7.91682 109.45 9.47875C109.45 11.0407 110.716 12.3069 112.278 12.3069ZM44.403 9.12512H50.2355L56.3957 23.8321H56.6578L62.8181 9.12512H68.6506V31.0146H64.0632V16.7672H63.8775L58.0887 30.9078H54.9649L49.176 16.7138H48.9903V31.0146H44.403V9.12512ZM77.5141 31.3246C75.9121 31.3246 74.5832 30.9149 73.5274 30.0955C72.4716 29.276 71.9437 28.054 71.9437 26.4294C71.9437 25.2038 72.2386 24.2419 72.8284 23.5436C73.4182 22.8453 74.19 22.3358 75.1439 22.0151C76.1051 21.6874 77.1391 21.4736 78.2459 21.3738C79.7022 21.2313 80.7435 21.0817 81.3697 20.9249C81.9959 20.7682 82.309 20.4262 82.309 19.8989V19.8347C82.309 19.1578 82.0906 18.6341 81.6537 18.2636C81.224 17.893 80.6124 17.7078 79.8187 17.7078C78.9813 17.7078 78.3151 17.8859 77.8199 18.2422C77.3248 18.5985 76.9971 19.0509 76.8369 19.5996L72.5335 19.2576C72.8539 17.7612 73.6476 16.5748 74.9146 15.6984C76.1888 14.822 77.8308 14.3837 79.8405 14.3837C81.0857 14.3837 82.2508 14.5761 83.3357 14.9609C84.4207 15.3457 85.2944 15.9478 85.9571 16.7672C86.627 17.5795 86.9619 18.6377 86.9619 19.9416V31.0146H82.5493V28.738H82.4182C82.0105 29.5005 81.3988 30.124 80.5833 30.6085C79.775 31.0859 78.752 31.3246 77.5141 31.3246ZM78.8466 28.1823C79.866 28.1823 80.7034 27.8937 81.3588 27.3165C82.0141 26.7322 82.3418 26.009 82.3418 25.1468V23.4046C82.1597 23.5257 81.8757 23.6326 81.4898 23.7253C81.1112 23.8179 80.7034 23.8998 80.2665 23.9711C79.8369 24.0352 79.451 24.0922 79.1087 24.1421C78.2932 24.2561 77.6342 24.4806 77.1318 24.8155C76.6367 25.1504 76.3891 25.6385 76.3891 26.2798C76.3891 26.9068 76.6185 27.3806 77.0772 27.7013C77.5432 28.0219 78.133 28.1823 78.8466 28.1823ZM92.8109 36.1022C94.0997 36.9716 95.8728 37.4062 98.13 37.4062C99.732 37.4062 101.148 37.1711 102.379 36.7008C103.609 36.2305 104.574 35.5322 105.273 34.6059C105.98 33.6796 106.333 32.5359 106.333 31.175V14.5975H101.713V17.3551H101.538C101.334 16.9062 101.035 16.4537 100.642 15.9977C100.249 15.5416 99.7356 15.1604 99.1021 14.854C98.4686 14.5405 97.6822 14.3837 96.7429 14.3837C95.5196 14.3837 94.3909 14.6973 93.357 15.3243C92.3303 15.9442 91.5038 16.8741 90.8776 18.1139C90.2587 19.3538 89.9492 20.9071 89.9492 22.774C89.9492 24.591 90.2514 26.0909 90.8557 27.2738C91.4674 28.4566 92.2866 29.3366 93.3133 29.9138C94.3473 30.4909 95.4941 30.7795 96.7538 30.7795C98.0936 30.7795 99.1495 30.5052 99.9213 29.9565C100.693 29.4007 101.232 28.7844 101.538 28.1074H101.734V31.1108C101.734 32.1868 101.403 32.9599 100.74 33.4302C100.085 33.9005 99.2514 34.1356 98.2393 34.1356C97.2126 34.1356 96.4225 33.9503 95.8691 33.5798C95.323 33.2164 94.9553 32.8138 94.766 32.3721L90.4625 32.9385C90.7392 34.1784 91.522 35.2329 92.8109 36.1022ZM100.828 26.1408C100.216 26.9531 99.3497 27.3593 98.2283 27.3593C97.0851 27.3593 96.2113 26.946 95.607 26.1194C95.0026 25.2929 94.7004 24.1706 94.7004 22.7526C94.7004 21.356 94.999 20.216 95.5961 19.3324C96.2004 18.4488 97.0778 18.0071 98.2283 18.0071C99.357 18.0071 100.227 18.4381 100.839 19.3003C101.45 20.1625 101.756 21.3133 101.756 22.7526C101.756 24.1991 101.447 25.3285 100.828 26.1408ZM110.035 31.0146V14.5975H114.688V31.0146H110.035ZM121.561 30.2665C122.799 30.979 124.277 31.3353 125.996 31.3353C127.488 31.3353 128.781 31.0716 129.873 30.5444C130.965 30.01 131.821 29.2653 132.44 28.3105C133.066 27.3557 133.416 26.2512 133.488 24.9972H129.098C128.959 25.8736 128.617 26.5505 128.071 27.0279C127.525 27.4982 126.851 27.7334 126.05 27.7334C124.965 27.7334 124.095 27.3058 123.44 26.4508C122.792 25.5886 122.468 24.3737 122.468 22.8061C122.468 21.2527 122.795 20.0521 123.451 19.2041C124.106 18.3562 124.973 17.9322 126.05 17.9322C126.902 17.9322 127.59 18.1852 128.115 18.6911C128.646 19.1899 128.974 19.849 129.098 20.6684H133.488C133.423 19.4001 133.07 18.2956 132.429 17.3551C131.795 16.4145 130.925 15.6841 129.819 15.164C128.719 14.6438 127.437 14.3837 125.974 14.3837C124.277 14.3837 122.814 14.7436 121.583 15.4633C120.352 16.1758 119.402 17.1698 118.732 18.4453C118.07 19.7136 117.738 21.1886 117.738 22.8702C117.738 24.5304 118.066 25.9983 118.721 27.2738C119.384 28.5492 120.331 29.5468 121.561 30.2665Z"
                        fill="#F8F8FA"
                      />
                      <path
                        d="M188.067 26.6677C188.086 27.218 188.214 27.6896 188.45 28.0827C188.686 28.4561 188.99 28.7607 189.364 28.9965C189.757 29.2127 190.189 29.3699 190.661 29.4682C191.152 29.5664 191.653 29.6156 192.164 29.6156C192.557 29.6156 192.97 29.5861 193.402 29.5271C193.835 29.4682 194.228 29.3601 194.582 29.2029C194.955 29.0457 195.26 28.8197 195.495 28.5249C195.731 28.2104 195.849 27.8174 195.849 27.3457C195.849 26.6972 195.603 26.2059 195.112 25.8718C194.621 25.5377 194.002 25.2724 193.255 25.0759C192.528 24.8597 191.732 24.673 190.867 24.5158C190.003 24.3389 189.197 24.1031 188.45 23.8083C187.723 23.4939 187.114 23.0616 186.622 22.5113C186.131 21.961 185.885 21.1946 185.885 20.212C185.885 19.4455 186.052 18.7872 186.387 18.2369C186.74 17.6867 187.182 17.2445 187.713 16.9104C188.263 16.5567 188.873 16.3012 189.541 16.144C190.229 15.9671 190.907 15.8787 191.575 15.8787C192.439 15.8787 193.235 15.9573 193.962 16.1145C194.69 16.2521 195.328 16.5075 195.879 16.8809C196.448 17.2347 196.9 17.726 197.235 18.3548C197.569 18.9641 197.765 19.7305 197.824 20.6542H195.318C195.279 20.1628 195.151 19.76 194.935 19.4455C194.719 19.1115 194.444 18.8461 194.11 18.6496C193.776 18.4531 193.402 18.3155 192.99 18.2369C192.597 18.1387 192.194 18.0895 191.781 18.0895C191.408 18.0895 191.024 18.119 190.631 18.178C190.258 18.2369 189.914 18.345 189.6 18.5022C189.285 18.6398 189.03 18.8363 188.833 19.0918C188.637 19.3276 188.538 19.6421 188.538 20.0351C188.538 20.4675 188.686 20.831 188.981 21.1258C189.295 21.4009 189.688 21.6368 190.16 21.8333C190.631 22.0102 191.162 22.1674 191.752 22.3049C192.341 22.4229 192.931 22.5506 193.52 22.6882C194.149 22.8257 194.758 22.9928 195.348 23.1893C195.957 23.3858 196.488 23.6511 196.94 23.9852C197.411 24.2996 197.785 24.7025 198.06 25.1938C198.355 25.6851 198.502 26.2943 198.502 27.0215C198.502 27.9451 198.306 28.7116 197.913 29.3208C197.539 29.93 197.038 30.4213 196.409 30.7947C195.8 31.1681 195.102 31.4236 194.316 31.5611C193.55 31.7184 192.783 31.797 192.017 31.797C191.172 31.797 190.366 31.7085 189.6 31.5317C188.833 31.3548 188.155 31.0698 187.566 30.6768C186.976 30.2641 186.504 29.7335 186.151 29.085C185.797 28.4168 185.6 27.611 185.561 26.6677H188.067Z"
                        fill="#F8F8FA"
                      />
                      <path
                        d="M169.149 10.4248H171.655V18.2955H171.714C172.126 17.4505 172.775 16.8413 173.659 16.4679C174.544 16.0748 175.516 15.8783 176.578 15.8783C177.757 15.8783 178.779 16.0945 179.643 16.5268C180.528 16.9592 181.255 17.5487 181.825 18.2955C182.414 19.0227 182.856 19.8677 183.151 20.8307C183.446 21.7936 183.593 22.8155 183.593 23.8964C183.593 24.9773 183.446 25.9992 183.151 26.9622C182.876 27.9251 182.444 28.7702 181.854 29.4973C181.284 30.2048 180.557 30.7649 179.673 31.1776C178.808 31.5903 177.796 31.7966 176.637 31.7966C176.263 31.7966 175.841 31.7573 175.369 31.6787C174.917 31.6001 174.465 31.4723 174.013 31.2955C173.561 31.1186 173.129 30.8828 172.716 30.588C172.323 30.2736 171.989 29.8903 171.714 29.4383H171.655V31.4723H169.149V10.4248ZM180.94 23.7195C180.94 23.0121 180.842 22.3242 180.646 21.6561C180.469 20.9682 180.184 20.359 179.791 19.8284C179.417 19.2978 178.926 18.8753 178.317 18.5608C177.727 18.2464 177.03 18.0892 176.224 18.0892C175.379 18.0892 174.661 18.2562 174.072 18.5903C173.482 18.9244 173.001 19.3666 172.627 19.9168C172.254 20.4474 171.979 21.0567 171.802 21.7445C171.645 22.4323 171.566 23.13 171.566 23.8374C171.566 24.5842 171.655 25.3114 171.832 26.0188C172.008 26.7067 172.284 27.3159 172.657 27.8465C173.05 28.3771 173.551 28.8095 174.16 29.1435C174.77 29.458 175.507 29.6152 176.371 29.6152C177.236 29.6152 177.953 29.4482 178.523 29.1141C179.113 28.78 179.584 28.3378 179.938 27.7875C180.292 27.2373 180.547 26.6084 180.705 25.9009C180.862 25.1935 180.94 24.4663 180.94 23.7195Z"
                        fill="#F8F8FA"
                      />
                      <path
                        d="M166.729 31.4137C166.297 31.6692 165.698 31.797 164.931 31.797C164.283 31.797 163.762 31.6201 163.369 31.2664C162.995 30.893 162.809 30.2936 162.809 29.4682C162.121 30.2936 161.315 30.893 160.392 31.2664C159.488 31.6201 158.505 31.797 157.444 31.797C156.756 31.797 156.098 31.7184 155.469 31.5611C154.859 31.4039 154.329 31.1583 153.877 30.8242C153.425 30.4901 153.061 30.0577 152.786 29.5271C152.531 28.9769 152.403 28.3185 152.403 27.5521C152.403 26.6874 152.55 25.9799 152.845 25.4296C153.14 24.8794 153.523 24.4372 153.995 24.1031C154.486 23.7494 155.036 23.4841 155.646 23.3072C156.274 23.1303 156.913 22.9829 157.562 22.865C158.249 22.7275 158.898 22.6292 159.507 22.5702C160.136 22.4916 160.686 22.3934 161.158 22.2755C161.63 22.1379 162.003 21.9512 162.278 21.7154C162.553 21.4599 162.691 21.0963 162.691 20.6247C162.691 20.0744 162.583 19.6322 162.367 19.2982C162.17 18.9641 161.905 18.7086 161.571 18.5317C161.256 18.3548 160.893 18.2369 160.48 18.178C160.087 18.119 159.694 18.0895 159.301 18.0895C158.24 18.0895 157.355 18.2959 156.648 18.7086C155.94 19.1016 155.557 19.8582 155.498 20.9784H152.993C153.032 20.0351 153.228 19.2392 153.582 18.5907C153.936 17.9421 154.407 17.4214 154.997 17.0283C155.587 16.6156 156.255 16.3208 157.002 16.144C157.768 15.9671 158.584 15.8787 159.448 15.8787C160.136 15.8787 160.814 15.9278 161.482 16.0261C162.17 16.1243 162.789 16.3307 163.339 16.6451C163.89 16.9399 164.332 17.3624 164.666 17.9127C165 18.4629 165.167 19.1802 165.167 20.0646V27.9058C165.167 28.4954 165.197 28.9277 165.255 29.2029C165.334 29.478 165.57 29.6156 165.963 29.6156C166.179 29.6156 166.435 29.5664 166.729 29.4682V31.4137ZM162.661 23.602C162.347 23.8378 161.934 24.0147 161.423 24.1326C160.912 24.2309 160.372 24.3193 159.802 24.3979C159.252 24.4569 158.692 24.5355 158.122 24.6337C157.552 24.7123 157.041 24.8499 156.589 25.0464C156.137 25.2429 155.763 25.5279 155.469 25.9013C155.194 26.255 155.056 26.7463 155.056 27.3752C155.056 27.7879 155.135 28.1417 155.292 28.4364C155.469 28.7116 155.685 28.9376 155.94 29.1144C156.215 29.2913 156.53 29.419 156.884 29.4977C157.237 29.5763 157.611 29.6156 158.004 29.6156C158.829 29.6156 159.537 29.5075 160.126 29.2913C160.716 29.0555 161.197 28.7705 161.571 28.4364C161.944 28.0827 162.219 27.7093 162.396 27.3163C162.573 26.9036 162.661 26.5203 162.661 26.1666V23.602Z"
                        fill="#F8F8FA"
                      />
                      <path d="M137.26 10.4248H140.061V29.1141H151.204V31.4723H137.26V10.4248Z" fill="#F8F8FA" />
                    </svg>
                  </Link>
                </>
              )}

              <button className={styles.closeButton} onClick={() => setIsOpen(false)}>
                <div>
                  <img src="/images/close.svg" alt="close navigation menu" />
                </div>
              </button>
            </Flex>
            {hasSidenav && <DocsSubNavbar />}

            <div className={styles.links} style={{ maxHeight: hasSidenav ? '60%' : '100%' }} ref={nodeRef}>
              <Flex.Column horizontal="flex-end">
                {hasSidenav ? (
                  <>
                    <Sidenav onRouterChange={() => setIsOpen(false)} />
                    <div className={styles.divider} />
                  </>
                ) : (
                  <Spacer size={40} orientation="vertical" />
                )}

                <div style={{ width: '100%' }}>
                  <Outset top={5} bottom={19} trim="vertical" wrapItemsWith="div">
                    {(leftLinks.filter(Boolean) as any).map((cfg: MainNavLink) => {
                      return <MainNavLinkButton isMobile size="sm" {...cfg} key={cfg.label + cfg.url} />;
                    })}
                    <Spacer size={10} orientation="vertical" />
                  </Outset>

                  <div className={clsx([styles.staticNav])}>
                    <div className={clsx(['d-flex'])}>
                      <CallToAction.a
                        href="/contact"
                        target="_blank"
                        rel="noreferrer"
                        className={isDarkNav ? styles.linkDark : styles.linkWhite}
                      >
                        Contact
                      </CallToAction.a>
                      <CallToAction.a
                        href="https://dashboard.magic.link/login"
                        target="_blank"
                        rel="noreferrer"
                        className={clsx(isDarkNav ? styles.linkDark : styles.linkWhite)}
                      >
                        Login
                      </CallToAction.a>
                      <CallToAction.a
                        href="https://dashboard.magic.link/signup"
                        target="_blank"
                        rel="noreferrer"
                        className={clsx(isDarkNav ? styles.buttonWhite : styles.buttonGrey, 'ms-3')}
                      >
                        Start Now
                      </CallToAction.a>

                      {/* <Outset top={5} bottom={19} trim="vertical" wrapItemsWith="div"> */}
                      {/*  {(rightLinks.filter(Boolean) as any).map((cfg: MainNavLink) => { */}
                      {/*    return <MobileNavLinkButton {...cfg} key={cfg.label + cfg.url} />; */}
                      {/*  })} */}
                      {/* </Outset> */}
                      {/* <Spacer size={15} orientation="horizontal" /> */}
                      {/* <div>{signUpButton && <>{signUpButton}</>}</div> */}
                    </div>
                  </div>
                </div>
              </Flex.Column>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
};

interface MobileNavLinkButtonProps {
  label: string;
  url: string;
  analyticsLabel?: Maybe<string>;
  trackDemoConversion: boolean;
}

/**
 * The button component rendered for each nav link.
 */
const MobileNavLinkButton: React.FC<MobileNavLinkButtonProps> = props => {
  const { label, trackDemoConversion, analyticsLabel, url } = props;
  const router = useRouter();
  const isExternalLink = !url.startsWith('/');

  return (
    <Link href={url} passHref legacyBehavior>
      <TextButton.a
        target={isExternalLink ? '_blank' : undefined}
        rel={isExternalLink ? 'noopener noreferrer' : undefined}
        size="sm"
        color={getPathFromURL(router.asPath) === getPathFromURL(url) ? 'primary' : 'tertiary'}
        onPress={() => {
          if (analyticsLabel) {
            AnalyticsService.TrackAction(analyticsLabel);
          }

          if (trackDemoConversion) {
            AnalyticsService.TrackDemo();
          }
        }}
      >
        {label}
      </TextButton.a>
    </Link>
  );
};
